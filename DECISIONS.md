##  Общая архитектура

Проект реализует три сервиса:
- **tts-service** — синтез речи со стриминговой отдачей PCM-данных;
- **asr-service** — распознавание речи по готовому аудиофайлу;
- **gateway** — единая точка входа, которая проксирует запросы к ASR и TTS, а также реализует e2e-поток (ASR → TTS).

Все сервисы написаны на **Python + FastAPI**, контейнеризированы через **Docker**, и объединены в одну сеть `speech_net` с общими volume-ами для моделей и логов.  
---

##  Выбор моделей

### ASR — **faster-whisper-small.en**
Для распознавания речи использовалась модель **faster-whisper-small.en**.  
Причины выбора:
- **Open-Source** и доступна без авторизации;
- полностью совместима с **CPU** ;
- **высокая скорость** инференса и **низкое потребление памяти**;
- хорошее качество распознавания английской речи, при этом не требует дополнительного обучения.

Интеграция прошла без проблем.

---

### TTS — **Piper TTS**
Первоначально планировалось использовать **Coqui TTS**, так как это популярное open-source решение с качественными голосами.  
Однако в процессе интеграции возникли проблемы:
- у Coqui TTS отсутствует полноценный режим **streaming output** «из коробки»;
- существующие community-патчи и fork-версии не имели актуальной документации, из-за чего не удалось добиться стабильной работы.

После нескольких попыток было принято решение перейти на **Piper TTS**:
- он лёгкий, кроссплатформенный, и поддерживает генерацию PCM-аудио в реальном времени;
- работает стабильно на CPU;
- простая установка и понятная структура моделей.

Возникла только одна проблема: библиотека `piper-phonemize` падала при инференсе из-за несовместимости зависимостей.  
Это было решено установкой пакета **`piper-phonemize-fix`**, который исправляет ошибку в функции фонемизации.

---

##  Что не заработало "из коробки" или не сделано

1. **Coqui TTS** — не удалось корректно реализовать стриминг. Большинство существующих решений требуют существенной переработки кода inference loop.
2. **Piper-phonemize** — нестабильная работа в стандартной версии, исправлено ручной установкой `piper-phonemize-fix`.
3. **Логирование** — в текущей версии слишком много `warnings`, что мешает анализировать поток логов. Пока не исправлено.
4. **Документация и комментарии** — по времени не успел оформить детально, особенно для gateway-сервиса.
